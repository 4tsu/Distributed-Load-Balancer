# 困ったところとかコツの記録
## MPIのバグは分かりづらい
MPIのバグは本当に分かりづらい。

デバッグ用関数として、`ckpt()`を置いておくようにした。これは、この関数を書いたところに、チェックポイントを標準出力するもので、内部にstatic変数を持っているので、何番目の`ckpt()`まで無事に実行できたかを手軽に確認する事ができる。

改行文字を出力すると直るバグに遭遇したが、これは通信のタイミングがずれた事による挙動の変化らしい。こういうときはMPI_Barrier()を挟んで解決するかどうかを確認する。MPI_Isend()やIrecv()のWait()部分にバグがあり、これが発生した。

MPIでstd::vectorを通信するときは、`&ベクタ`とするとうまくいかない。きちんと`ベクタ.data()`と書くこと。関数の引数にベクタを渡し、関数内部で通信するときも同様。

## Pythonでプロトタイプを書くべきか
今回はPythonでシリアルのMDを書いてから、それを見つつ実装した。したがって、MPI以外でバグが入ることは殆どなかった。

更に、Pythonで書いているということは、インデントをしっかり入れているということであり、結果的に見やすいC++コードになったと思う。

一方で罠もあり、例えばif文である。Pythonはif文の内部をインデントで管理する。C++は{}でくくるのが基本だが、これは文を一括りにしているに過ぎない。したがって、{}を書かずに文だけ書いてしまっても良いのだが、このとき、if文の範囲内になるのは最初の1文だけである。つまり、Python丸写しでインデントだけつけた状態で満足していると、プログラムは動作はするが、if文の有効範囲だけずれて望んだ結果にならないという面倒なことになる。if文のときは{}をつける癖があったほうが良い。
```
if () 
    aaaaaaa; <- ここだけif文の中
    bbbbbbb; <- こっちはif文の外
```